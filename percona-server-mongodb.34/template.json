{
    "variables":{
        "vm_name": "percona-mongodb-34",
        "cpu": "2",
        "ram_size": "1024",
        "iso_url":"http://cdimage.debian.org/cdimage/archive/8.8.0/amd64/iso-cd/debian-8.8.0-amd64-CD-1.iso",
        "iso_checksum_type":"sha256",
        "iso_checksum":"673079527fdf3a91e8bfc9e0312f94316820ca795bb6a1b2af1e8461eb78179c",
        "disk_size": "21440",
        "ssh_username":"packer",
        "ssh_password":"packer"
    },
    "builders":[
        {
        "type": "docker",
        "image": "debian:jessie",
        "commit": "true",
        "changes":[
            "VOLUME [\"/data/db\"]",
            "ENTRYPOINT [\"/entrypoint.sh\"]",
            "EXPOSE 27017",
            "USER mongodb",
            "CMD [\"mongod\"]"
        ]
    },
    {
        "vm_name":"{{user `vm_name`}}",
        "type": "hyperv-iso",
        "cpu": "{{user `cpu`}}",
        "ram_size": "{{user `ram_size`}}",
        "generation": "1",
        "disk_size": "{{user `disk_size`}}",
        "iso_url":"{{user `iso_url`}}",
        "iso_checksum":"{{user `iso_checksum`}}",
        "iso_checksum_type":"{{user `iso_checksum_type`}}",
        "communicator": "ssh",
        "ssh_username":"packer",
        "ssh_password":"packer",
        "http_directory": "http",
        "enable_secure_boot": false,
        "boot_wait": "15s",
        "boot_command": [
            "<esc><wait>",
            "install <wait>",
            " preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg <wait>",
            "debian-installer=en_US.UTF-8 <wait>",
            "auto <wait>",
            "locale=en_US.UTF-8 <wait>",
            "kbd-chooser/method=us <wait>",
            "keyboard-configuration/xkb-keymap=us <wait>",
            "netcfg/get_hostname={{ .Name }} <wait>",
            "netcfg/get_domain=vagrantup.com <wait>",
            "fb=false <wait>",
            "debconf/frontend=noninteractive <wait>",
            "console-setup/ask_detect=false <wait>",
            "console-keymaps-at/keymap=us <wait>",
            "grub-installer/bootdev=/dev/sda <wait>",
            "<enter><wait>",
            "<wait10><wait10><wait10><wait10><wait10><wait10>",
            "<wait10><wait10><wait10><wait10><wait10><wait10>",
            "<wait10><wait10><wait10><wait10><wait10><wait10>",
            "<wait10><wait10><wait10><wait10><wait10><wait10>",
            "<wait10><wait10><wait10><wait10><wait10><wait10>",
            "<wait10><wait10><wait10><wait10><wait10><wait10>",
            "<wait10><wait10><wait10><wait10><wait10><wait10>",
            "<wait10><wait10><wait10><wait10><wait10><wait10>",
            "<wait10><wait10><wait10><wait10><wait10><wait10>",
            "<wait10><wait10><wait10><wait10><wait10><wait10>",
            "<wait10><wait10><wait10><wait10><wait10><wait10>"
            ],
        "shutdown_command": "echo 'packer' | sudo -S shutdown -P now"
    }
],
    "provisioners": [
        {
            "type":"shell",
            "script": "scripts/ansible.sh"
        },
        {
            "type":"file",
            "source": "scripts/ps-entry.sh",
            "destination": "/entrypoint.sh"
        },
        {
            "type":"ansible-local",
            "playbook_file":"ansible/main.yml",
            "playbook_dir":"ansible"
        },
        {
            "type":"shell",
            "script": "scripts/cleanup.sh"
        }

        ],
    "post-processors": [
        [
            {
                "type": "docker-tag",
                "repository": "tmosleytc/packerdemo",
                "tag": "0.1"
            }
        ]
    ]
}